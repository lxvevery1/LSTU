## Устройство PDU
PDU - порция данных в форме массива байтов некоторой длины

Как посчитать размер 
PayLoad = Общий размер PDU - размер header - размер footer.
Размер заголовка + 1 байт от начала PDU

Payload необязателен (диалог без передачи данных) -> PDU будет из header и footer
header, содержимое которого полностью определяется рассматриваемым протоколом (содержит собственные служебные данные этого протокола)

Протокольные модули стекируются.
Инкапсуляция -> PDU протокола более выше стоящего уровня становится Payloadom PDU ниже стоящего уровня. PDU этого уровня называется message -> чтобы его передать протокол должен сформировать PDU Транспортного уровня. Операция когда мы делим PDU на короткие называется сегментация, чтобы это произошло -> нужно чтобы в заголовке была названа позиция. Размер сегмента должен полностью влезать в пакет. В IPv4 предусмотрена сегментация сегмента (но лучше избегать этого). Что с появившимся сегментом делать? Нужно его инкапсулировать пакеты (пакет отличается от сегмента тем, что у него есть хедер) -> для сетевого уровня не важно что внутри сегмента, он лишь добавляет свой заголовок.
Основная функция сетевого уровня - коммутация пакетов. То есть сетевой уровень принимает решение для пакета -> в итоге образуется frame (pdu канального уровня). Канальный уровень выполняет задачу передачи кадров. Одна из задач которая решается при доставке - контроль правильности (средства контроля, это потом). Теперь это матрешка: заголовок канального, сетевого, транспортного, а затем фрагмент сообщения. Теперь нужно эту матрешку в линию связи. Для этого нужно преобразовать порцию в поток битов (transmit с канального уровня). Разделители - биты, разделяющие порции данных в потоке. 
Заголовок нужен чтобы peer модель узла отправителя мог общаться между peer другого модуля узла.
Преобразования данных в стеке протоколов.

Сегментация -> (чтобы в каждом потоке было доставлено PDU (порой для PDU не хватает одного блока информации, делим на пакеты))
Инкапсуляция (обернуть в заголовок trailer) -> нужна чтобы транспортный уровень мог реализовать протокол (чтобы общаться)
На выходе транспортного слоя образуется пакет.
На сетевом уровне происходит коммутация для обновления заголовка.

Link layer:
Инкапсуляция (для свой инфы)
Сериализация
Выделение кадров (framing)
Декапсуляция

На транспортном уровне происходит декапсуляция и затем реассемблинг

Мультиплексирование протоколов
В заголовке предусматривается поле (дескриминатор протокола), теперь он может различать протоколы (1, 6, 17, ...) Логика IP простая: получив пакет выяснив что нужно доставить, берет код из заголовка и доставляет по его индексу. 
Второй пример демульт и мульт на транспортном уровне: когда IP модуль получил пакет ему надо отдать какому-нибудь экземпляру. Внутри IP только протокол -> нужно мультиплексирование экземпляров. Диспетчер (Singleton) получает все пакеты, зная всю структуру транспортного выделяет дескриминатор экземпляра (Port) -> по этому номеру порта доставил пакет соответствующему экземпляру.

IP пакет -> IP hdr + TCP hdr(номер порта) + Payload

Что такое структура стека? Схема кто в кого инкапсулируется: 
Сколько экземпляров под IP -> столько же сколько и интерфейсов (точка присоединения узла к звену -> сколько звеньев столько и узлов)

![[Pasted image 20240316121603.png]]


Дескриминатор - поле в заголовке PDU (поле в IP заголовка, только IP знает как обрабатывать дескриминатор)

Туннелирование - в TCP соединении передаются IP проекты. Программа (APP) создает виртуальный логический интерфейс и как бы передает кадры от лица виртуального интерфейса. 
Когда к нам пришел пакет в нем будет 
1. Заголовок канального уровня 
2. IP
3. TCP 
4. IP-Штрих 
5. Payload

Практика УРАА

## Internet Protocol Suite (IPS)
Suite - архитектура из множества (тысяч) разных протоколов, которые образуют интернет

TCP/IP альтернативное и менее точное название IPS
Основу (ядро) от всего этого suite представляет совокупность протоколов IP + TCP. Когда появилась связка транспортного TCP и сетевого IP началось появление suite.
Смысл в том, что это процесс в рамках которого любой желающий может создать свой протокол. Открытый процесс стандартизации (нужно чтобы этот протокол конечно же работал). Результатом процесса стандартизации явился набор стандартов RFC, описывают все эти протоколы. 

Сейчас будем изучать IP (3, сетевого уровня)

Internet - это собственное название и принято писать с большой буквы
internet - способ каким образом строить большие комп. сети
В IPS ещё есть собственное представление network - кусок провода, к которому подключено несколько станций (Ethernet). Большая сеть - совокупность маленьких -> Тоже можно назвать network (internetwork)
 
### Двухточечная сеть (Point-to-point network)
сеть, между с обеих сторон которой находятся интерфейсы, с помощью которых общаются 2 узла.
Дуплексный режим - когда оба узла могут передавать и получать кадры параллельно, не прерывая друг друга.

### Многоточечная сеть и её адресация
Broadcast - все слышат друг друга -> обмениваемся данными между всеми станциями, но придется общаться по очереди. Несколько интерфейсов подключены 

Адрес - код (биты) которые указаны в канальном хедере. Адрес назначения - я этот кадр назначаю X адресу. Каждому интерфейсу может быть назначено несколько адресов. Собственный адрес (уникальный код) + может быть несколько ещё (групповых неуникальных адресов). Такая организация работает так: каждый интерфейс когда слышит сигнал по среде анализирует какой адрес назначения в этом заголовке. Умеет найти в нем адрес назначения. Данный кадр принимается в ... Служебный адрес (слушайте все / broadcast adress) Интерфейс принимает что 

В такой многоточеченой сети есть 3 вида передачи: 
1. Broadcast (нужно передать пакет всем, подклченным к этому кабелю) - все что нужно это указать бродкааст адрес
2. Юникаст (индивидуальная передача) - указываем белый (уникальный) адрес  интерфейса
3. Групповой, используя групповой адрес (Multicast) отправитель кадра указывает один из адресов (адрес группы, например выставим частоту радиостанции, из-за того у одного интерфейса может быть множество групповых адресов, то можно подписываться на передачу из других адресов). 
Что такое internetwork - несколько сетей, изолированные друг от друга. Где у интерфейсы одного netwrok не смогут общаться с интерфейсами другого netwrok 
Теперь можем добавить ещё один узел (и два интерфейса) и включить все сразу. Теперь этот узел - шлюз (gateway) и является маршрутизатором коммутатором

В терминах IPS любые узлы - host - пк, сервер, гаджет, подключенный к сети и способный выполнять коммутацию пакетов
Interface - точка подключения узла к сети
Multihorned host - узел сети, укомплектованный несколькими сетевыми интерфейсами
Шлюз - Multihorned host, подключенный к нескольким различным сетям с функцией транзита.
Маршрутизатор - устройство, изолирующее сети друг от друга.