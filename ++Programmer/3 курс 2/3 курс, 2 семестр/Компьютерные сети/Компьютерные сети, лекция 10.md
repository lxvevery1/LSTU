## Управление звеном передачи данных
Link control - управление звеном передачи данных
Управление - искусство наука о том как достигать заданной цели.
Когда кто-то чем-то управляет что-то начинает работать с целью
Какие процессы управляют звеном?
Несколько функций, попадающих под управление звеном:
1. Flow control - 2 звена передачи данных. Первое устройство, должно успевать обрабатывать данные второго. 
2. Мультиплексирование протоколов - есть общее звено передачи (шина езернет) для функционирования нескольких сетевых протоколов
3. Управление установки и соединения 
4. Управление доступом к сети и передачи

2 устройства - слева передает данные приемника. Сам канал имеет vspd (скорость с которой флажки машут руками) Технически преедатчик способен передавать vspd данных. 
Здесь V обработки на приемнике (чем ограничена эта скорость? - тактовая частота, алгоритм)
Что будет если v принятия будет больше чем v обратная - принимающая сторона будет накапливать пакеты в буфере и рано или поздно будет переполнение буфера. Начинают работать ARQ пакеты, повторяющие отправку выкинутых из буфера пакетов.
То есть темп передачи должен соотв. темпу принятия.
Приемник посывлает сигналы готовности принятия сигналов
2 класса:
1. START/STOP - при стоп передатчик должен перестать передавать, при старт можно продолжить передачу. Благодаря этим сигналам применик может вставлять паузу при передаче
2. Credit based - приемник зная размер своего буфера дает передачтику кредит - объем данных которые можно передать - передачтик если исчерпывается кредит останавливает передачу. ПРиемник умеет увеличивать кредит, благодаря чемк применик и передачик могут иметь одтнаковый темп передачи управляемый приемником

Парадигма смывного бочка - имеет high water mark - бферная память применика выступает бочком. Как только уровень доходит до high wm, приемник передает STOP, передатчик заканчивает передачу и уровень падает до нижней границы Low WM, после чего приемник передает START. Почему HWM, а не размер буфера? Потому что передачтик может не сразу отреагировать и запас по hwm позволяет иметь небольшое окно, необходимое для того чтобы данных было не слишком много.
## Схема кредитов
как работает? 
ресивер говорит у тебя есть кредит = 3, отправляет 3 порции данных
Передатчик 3 передал и ждет. Приемник начианет обрабатывать дата1, в конце обработки дает +1 кредит и довольно быстро приемник и передатчик входят в ритм, с паузами достаточными для полной передачи данных. Этот механизм работает на уровне шины PCI.

## Установка соединения
Материал про устройство телефонной сети

## Управление доступом к среде передачи
Media Access Control - процедура доступа нескольких станций к общей разделяемой среде передачи
Дуплексный режим - две отдельные среды передачи. mac - не требуется.
Как обеспечить дисциплину доступа к среде?
Двухточечные звенья могут работать в дуплексном режиме (звено распадается на два полузвена, одно звено занимается передачей из a в b, и параллельно второе из b в a)
"Этот сетевой адаптер обрабатывает 200 мб в секунду" - 100 мб в одну и 100 в другую
Когда работает дуплексное звено MedAccContr 
Если говорить про полудуплексный режим, каждый узел имеет передачтик и приемник и переключатель. Можно слышать, но не переавать и наоборот. Возникает дисциплина когда в какой момент вреени нужно переключать поведение.
Дисциплина доступа - решает проблему коллизии 
(2 и более станции передают данные одновременно)
На уровне сигналов один сигнал накладывается на другой и обе передачи не работают. В момент колизии данные искажаются поэтому нужно придумать дисциплину, чтобы коллизия не влияла 
1. Исключение коллизии
	1. Передачтик не имеет права передачи, если ему не дают
2. Колизия быстро обраатыватся
	1. Режим соперничества
## Режим Master-Slave
Предполагает что многоточенчное звено (станции которые к нему подключены деляятся на мастера и слейва). Есть только один мастер и many слейвов.
У каждого звена есть номер. На таком звене передача данных 
У мастера есть 3 варинта (кадры 3 типов - опрос, выборка, оповещение)
В начале кажлого кадра находится AS (Address slave), Управляюий байт (вид действия (пол, селект)), данные (только при выборке или оповещении), CRC

Мастер обязан опрашивать слейвов. Должен передавать кадры опросов. Если слейв обнаруживает что пришел кадр с его адресом, то надо ответить. Слейв, познав свой адрес и к нему пришел пол, он может отправить кадр в ответ, если данных нет, то передает EOD.
Т.о. мастер спраишвает всех поочередно в цикле.
в ответ на селект слейв может передать ack (готов) и nack (не готов)

В этом режиме есть 3 варианта обмена данных (от м к с, от с к м, броадкаст от м к с)
Слейв не имеет права начинать передачу по своей инициативе (исключает колизии).
Для того чтобы передать данные слейв должен дождаться пол от мастера
Для дуплексной передачи мастер должен циклично опрашивать слейвов.
Если слейв отключился либо кадр был искажен, то узел его игнорирует. Возникает тайм-аут. Мастер ждет ответа, а его нет. Тайм-ауты понижают реактивность звена. Если слейв отключился, то мастер должен исключить его из списка. Что делать, если он включился? Как встать в очередь? Периодически опраишвать хотят ли слейвы встать в цикл. Мастер становится центром и в случае чего режим работать не будет.
Как обеспечить надежность работы мастера? Несколько матсеров, но как выполнять арбитраж (очередь (я мастер, а потом ты мастер?))
Реализация передачи права матсеризации - режим маркерной шины
## Token bus - режим маркерной шины
Режим эстафетной палочки. Реализуется на топологии шины с помощью токен бас, в такой шине все станции являются комбинированными. Могут быть и мастерами и слейвами. Причем слейвами являются всегда, а мастером если им дают токен. Токен передается от станции к станции. У каждой станции есть свой адрес по которому они передают токет. В каждый момент времени токеном владеет одна станция, после N передач обязана передать токен другой станции. 
Монополизировать токен == снижать реактивность звена.
Чтобы звено работало маркер должен ходить по кругу и циркулировать. Для этого все станции формируют логическое кольцо. Каждая станция в кольце знает номер след. станции (адрес той станции, которому она отдаст маркер). 
Процедура автомат. конфигурации устроена на тайм-аутах. Передачу маркеров слышат все, поэтому любая станция может фиксировать тайм-аут. Если в течении m сек. не слышна передача маркера, то запускается реконфигурация кольца. 
Реконфигурация построена на двух тайм-аутах. В итоге все станции слышат колизию. Когда наступила тишина начинает отсчитаваеться первый тайм аут. Станция отправляет кадр поиска след. станцииЮ который все слышат и начинается отчитывать первый тайм-аут. Таким образом выстраивается цепочка от малого к старшему номеру. Если след. станций больше нет, то срабатывает второй таймаут у первой станции. Поняв, что следующая станция, передает маркер след. партнеру.

## Характеристики режима token-bus
Справедливость - если станции работают, то пропускная способность нормально передается через все узлы. Так как колизии сведены к 0, сред занята передачей маркером, реконфигурации.

## Режим соперничества
Вторйо подход используется в жизни почаще. Каждая станция может быть и С и М. Момент времени когда станция становится М определяет сама. Не исключается что М.count > 1. Чтобы с колизиями сосуществать применяются меры по снижению возникновения колизии. Попытка избжать колизии
Если колизия возникла, то нужно минимизировать потерю времени.
Третий вариант - если в процессе передачи случилась колизия, то выполяется повторная передача данных

## Технология Ethernet
Коаксиальный кабель - соостный (линия центр размерной линии). 
Кабель слабогнущийся и в нескольких местах где стояли комьютеры делались проколы (укус вампира) (чтобы втыкаемая иголка втыкалась до жилы)
Терминаторы - сопротивление, образующее замыкание цепи. Играют роль отражателя волн и огрничения пропуска волнового сигнала (волновое сопротивление).

адаптер ethernet состоит из 
1. Передатчик
2. Приемник
3. Детектор передачи (CS) 
4. Детектор колизии (CD)
Благодаря этим детекторам был построен регламент доступа адаптера к среде. Очевидно, что если на шине идет передача, то нет смысла вклеиваться. Если станция решила что-то передать, то она убедится, что шина свободна. Если шина занята, то нужно подождать пока она освободится и отсчитает короткий тайм-аут. 
Когда станция начала передачу, она контролирует сигнал с детектора колизии. Если станция не слышит что передается, и кто-то будет передавать сигнал ещё сработает детектор колизии (минимальная задержка). Если детектор колизии сработал, то 
Если не передано мин размер кадра (64 байта), то станция продолжает передавать сигнал.
Выключить передачу (если >= 64 б). После этого нужно выдержать паузу (рандомизированная). 
stat_time = rand(0...2^c-1),
При таком расклде вероятность колиззи сильно снижается. Но есть некий опасный период, когда колизия может возникнуть и есть такие, к оторых она возникнуть не может
Чем длинее сегмент, тем больше эффект задержки.
После того когда станция c1 передавала c5, есть микро окно в котором может возникнуть колизия ( == длина провода + кол-во станций)


