# Инфраструктурная служба - DHCP

Вручную указываем IP, структ. - те настройки которые надо задать для сетевых адаптеров, чтобы компы работали
Нужна уникальность ip адресов.

при ручной конфигурации ip адресов - Если возникает проблема что надо что-то поменять, то придется заново пройти перенастройку всех компов

DHCP:
1. Назначить адрес ip
2. Передать ряд настроек интерфейсов сетевых адаптеров
3. Обойтись без админа

2 участника:
1. DHCP сервер - отвечает за центр. хранение настроек, за ведение бд выданныех ip адресов, клиенты к нему обращаются, а он отдает свои конфиг. настройки.
2. DHCP клиент - Если что-то выдаем динамически, то нужны механизмы для отказа/продления

Спецификация не подразумевает совместную работу нескольких DNS-адресов.
Но такая возможность есть, но они не должны контактировать (не мешать)

Еще один участник - объект трансляции DHCP
Клиент должен получить ipaddr в тот момент когда у него его нет. Клиент не способен работать в ... Необходим механизм позволяющий
клиентам обращаться к адресам
Послать широковещательный запрос. Здесь главная проблема - ограничены одним сегментом сети -> Если в некоторой организации ip имеет несколько сегментов,
то нужен в каждом сегменте свой DHCP сервер

DHCP имеет прослушиватель - агент трансляции - работает на маршрутизации и является частью протокола на маршрутизаторе

Для того чтобы клиенты могли взаимодействовать в DHCP сервером то на сервере настроено что агент ретрансляции отправляет к DHCP серверу - <u>DHCP-Relay</u>,
то есть позволяет получать ip адрес клиентам, которые находятся в разных сегментах

Пока клиент не получил ipaddr общение возможно только на канальном уровне.
На сетевом только широковещательный, а DHCP-Relay посылает ответы


<u>Основные понятия </u>
Основным объектом который натраивается в DHCP - ялвяется область - scope - непрерывное пространство ipaddr которым управляет DHCP сервер

Супер-область - позволяет объединить несколько областей в одну

## Зачем нужна область?

Клиент посылает широковещательный запрос для получения ipaddr
Этот запрос ловит либо сервер (знает идентификатор сети), либо DHCP-Relay (знает)
DHCP должен определить какой адрес выдать
Широковещательный запрос: у сервера по адресу интерфейса сервер знает куда отправить запрос

Если pc01 запустился - посывлает широковещательный запрос дай мне ipadd. Сервер понимает что клиенту надо выдать ip, который коррелирует с его текущим
А должен ли  что-о ему выдавать? Среди настроенных областей находит подходящуу, в которую поступил запрос
Если запрос поступает не лично от сервера, а от агента ретрансляции. То он понимает на каком интерфейсе запрос был получен
И сервер уже для этого адреса ищет подходящую область (поиск по маске сети)

Важно, чтобы у сервера была облать

Для того чтобы сервер мог выдавать адреса клиентам, то нужно иметь соотв. маску
У клиента нет никакой информации.

В сети есть устройства со статич. ip адресами.
Чтобы их исключить указываются диапазоны исключения - exclusion

Укажем, что адреса
192.168.0.1-10/24 - для таких-то
192.168.0.200-220/24 - для таких-то
Из области выразем те ipaddr которые сервер гарантированно выдавать не будем
Все что осталось - пул ipaddr, любой из которых сервер может выдать

С пулом сервер и работает


Когда к серверу приходит запрос от клиента, то он может дать рандомный адрес из пула.
Потом клиент начинает обращаться за ipaddr, отдает его и говорит что он выдан

По запросу клиента может выдать любой адрес из пула

Иногда необходимо чтобы клиенты получаели не произвольные, а конкретные ipaddr

<u> Механизм резервирвования </u>
Вот этому клиенту вот такой ip addr
Клиент же резервируется по MAC-адресу -> ipaddr

Резервированные адреса - любые из пула

Когда клиент запросил ipaddr - произвольный либо из резерва
Сервер выдает адрес на период аренды и заносит запись в таблицу аренды ipaddr
как толкьо срок аренды истек, сервер возвращает адрес и клиент должен прекратить использование этого адреса
По истечению половины вермени DHCP клиент посылает DHCP серверу запрос на продление адреса и новый срок аренды сдвигается
Самое главное, чтобы оба были online
Если клиент выключается вне указанного срока, то при ключении придется запросить новый ipddr

Если у сервера есть возможность выдать тот же адрес, то он его выдаст. Иначе возьмет другой из пула.

Срок периода аренды очень важен.

Если сеть с частоменяющимися клиентами, то время обновления нужно указать поменьше

Можно задать не только зарезервированных ipaddr, но и соотв. настройки


Широковещательный запрос - запрос обнаружения DHCP сервера

Мне нужен ipaddr!

DCHP сервера проверяют могут ли предложить свободный адрес и отсылают DHCP-Request
Клиент выбирает подходящий адрес
