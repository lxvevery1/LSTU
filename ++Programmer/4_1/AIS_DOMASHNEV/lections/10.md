В прошлый раз рассмотрели о доставке письма

В обычном режиме, когда не тнутренней цепочки маршрутизации почты

Почему сервер исходящей почты может отклонить письмо?
Не проходит по политикам безопасности содержимое письма.
Размер, кол-во адресатов (много)
Если нет адресатов, если нет места, то оно уйдет, но в ответ вы получите новое письмо о недоставке
Открытый relay - любой может отправить письмо через другой почтовый домен - обычно запрещено.
Либо в анонимном режиме выполнить relay, либо само письмо.
Севрер скорее всего заберет письмо.
Письмо будет в прцоессе доставки либо отклонено.

# SMTP

По SMTP получатель не проверяется


Какие протоколы используются в процессе работы эл. почты.

UTU - unix-to-unix

SMTP или SMTPS - simple mail transport protocol
smtp default port: 25

Клиент подключается, выдает команду, сервер выполняет и выдает код результата выполнения команды

Переход от SMTP к SMTPS -> уже прочитать нельзя
Начинается работа с команды Hello.
И указывается DNS-имя клиента

Клиент может указать любое DNS-имя.
Так как SMTP используется в двух местах:
между к-с и с-с
в к-с используется аутентификация
между с-с используется в анонимном режиме

За счет проверки днс имени проверить его подлинность
Почтовый сервер видит в какого ip поступило подключение

HELO - команда в SMTP. В расширенной версии приветственная команда - EHLO. Можно проверить

pass - передача логина и пароля. Возможен вариант анонимной работы
return 220 -> ok!

...

Клиент управляет всей работой протокола, а сервер активности не проявляет, только выполняет команды.


# POP3

port: 110
Есть версия POP3S - 465 порт

POP3 требует обязательной аутентификации.
Почтовые агенты на POP3 работают так:
проверяеют входящую потчу, соединение с сервером, прохождение аутентификации, отправка писем.
Получил? Да. Сервер удаляет письмо после подтверждения.

Протокол синхронный.
В 1997 году было ограничение на 8мб

Письма забирались, потому что дисковое пространство было слишком дорогим.
Со временем использования подхода

Когда человек работает и получил письмо на работе, то из дома уже посмотреть на письмо не получится

.
Не удалять письмо на сервере? Не отправлять письмо о получении письма


# IMAP

IMAP4 - с установкой соединения.
std port: 143

Письма хранятся на сервере всегда
Письма при работе данного протокола не удаляются с сервера.
Процесс получения почты. Информация о наличии писем клиенту.
Когда открываем письмо, то оно кэшируется, но не удаляется на сервере.

В POP3 таого не было:
при большом объеме писем их надо каталогизировать - распределить по разным папкам
В POP3 было, но на стороне клиента. На сервере это все было в куче
В IMAP эта работа выполяется на стороне сервера - перемещает письма между папками.
Это стало когда дисковое пространство стало дешевле

IMAPS работает аналогично


# Электронное письмо
Текстовое сообщение, состоящшее из двух частей - залоговок и (пустая строка и) тело письма

залоговок письма сожержит поля письма - имя + значения
Какие поля в разделе заголовка присутствуют?

1. Тема
2. To
3. CC - список доп. адресатов
4. From
5. Reply To (тольо при ответе)
Поля в одном экземляре:
    6. Date
    7. MessageID
8. Received - поле для сервера: от кого приянял, когда и сам сервер
9. Return Path - поле добавляется SMTP сервером в цепочке машрута и укзаывает куда нужно возвращать письмо

Вложенные файлы шифруются BASE64(раздувает на 30%) и вкладываются в тело письма

Псевдонимы
Адрес, не содержит почтовый ящик.
